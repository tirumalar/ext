SRC=main.c communication_api.c cybtldr_api.c cybtldr_command.c cybtldr_parse.c
OBJ=$(subst .c,.o,$(SRC))
all: icm_communicator

%.o: %.c
	gcc -Wall -g -c $< -o $@

icm_communicator: $(OBJ)
	gcc -Wall -g -o $@ $+

test1:
	./cybootload_linux "test/Bootloadable Blinking LED.cyacd"
test2:
	./cybootload_linux test/CY8CKIT-049-41XX_GPIO_Example.cyacd
test3:
	./cybootload_linux test/CY8CKIT-049-41XX_PWM_Example.cyacd

test4:
	./cybootload_linux test/CY8CKIT-049-41XX_UART_Example.cyacd

clean:
	-rm *.o icm_communicator 

StringImage.h: "Bootloadable Blinking LED.cyacd"
	perl conv.pl "$<"


gdb: cybootload_linux
	-rm -f gdb.log
	gdb -batch -x run.gdb
